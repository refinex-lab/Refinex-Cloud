# 响应状态码

## 概述

`HttpStatusCode` 是一个标准的 HTTP 状态码枚举类，用于规范 REST API 中 HTTP 状态码的正确使用，确保 API 响应的语义准确性。

## 枚举字段说明

每个状态码枚举值包含以下四个字段：

- **code**: HTTP 状态码（Integer）
- **reasonPhrase**: 英文标准名称（String）
- **message**: 中文用户友好提示（String）
- **description**: 中文详细描述（String）

## 状态码分类

### 2xx 成功状态码

| 状态码 | 枚举值 | 中文提示 | 使用场景 |
|--------|--------|----------|----------|
| 200 | OK | 操作成功 | GET、PUT、PATCH 成功获取或更新资源 |
| 201 | CREATED | 创建成功 | POST 成功创建资源 |
| 202 | ACCEPTED | 请求已接受 | 异步操作已接受 |
| 204 | NO_CONTENT | 操作成功 | DELETE 成功或更新无返回内容 |

### 3xx 重定向状态码

| 状态码 | 枚举值 | 中文提示 | 使用场景 |
|--------|--------|----------|----------|
| 301 | MOVED_PERMANENTLY | 资源已移动 | API 端点永久迁移 |
| 302 | FOUND | 临时重定向 | 临时重定向到其他端点 |
| 304 | NOT_MODIFIED | 资源未变化 | 缓存验证，资源未修改 |

### 4xx 客户端错误状态码

| 状态码 | 枚举值 | 中文提示 | 使用场景 |
|--------|--------|----------|----------|
| 400 | BAD_REQUEST | 请求参数有误 | 请求参数验证失败 |
| 401 | UNAUTHORIZED | 身份验证失败 | 缺少或无效的认证信息 |
| 403 | FORBIDDEN | 没有访问权限 | 已认证但无权限 |
| 404 | NOT_FOUND | 资源不存在 | 资源未找到 |
| 405 | METHOD_NOT_ALLOWED | 请求方法不支持 | HTTP 方法不支持 |
| 409 | CONFLICT | 操作冲突 | 资源状态冲突 |
| 410 | GONE | 资源已永久删除 | 资源已永久删除 |
| 412 | PRECONDITION_FAILED | 条件验证失败 | If-Match 验证失败、乐观锁冲突 |
| 422 | UNPROCESSABLE_ENTITY | 业务处理失败 | 语义错误、业务逻辑验证失败 |
| 429 | TOO_MANY_REQUESTS | 请求过于频繁 | 超过速率限制 |

### 5xx 服务器错误状态码

| 状态码 | 枚举值 | 中文提示 | 使用场景 |
|--------|--------|----------|----------|
| 500 | INTERNAL_SERVER_ERROR | 服务器错误 | 未预期的服务器错误 |
| 502 | BAD_GATEWAY | 网关错误 | 上游服务返回无效响应 |
| 503 | SERVICE_UNAVAILABLE | 服务暂时不可用 | 服务维护或过载 |
| 504 | GATEWAY_TIMEOUT | 网关超时 | 上游服务超时 |

## 最佳实践

### 1. RESTful API 状态码选择指南

| 操作 | 成功场景 | 推荐状态码 |
|------|----------|------------|
| GET | 获取资源成功 | 200 OK |
| POST | 创建资源成功 | 201 CREATED |
| PUT/PATCH | 更新资源成功 | 200 OK |
| DELETE | 删除资源成功（有返回） | 200 OK |
| DELETE | 删除资源成功（无返回） | 204 NO_CONTENT |

### 2. 错误场景状态码选择

| 错误场景 | 推荐状态码 | 推荐异常类 |
|----------|------------|------------|
| 请求参数格式错误（如 JSON 格式错误） | 400 BAD_REQUEST | BusinessException |
| 请求参数验证失败（如邮箱格式不正确） | 400 BAD_REQUEST | BusinessException |
| 未登录或 Token 无效 | 401 UNAUTHORIZED | BusinessException |
| 已登录但权限不足 | 403 FORBIDDEN | BusinessException |
| 资源不存在 | 404 NOT_FOUND | BusinessException |
| 重复创建资源 | 409 CONFLICT | BusinessException |
| 业务规则验证失败 | 422 UNPROCESSABLE_ENTITY | BusinessException |
| 并发冲突（乐观锁） | 412 PRECONDITION_FAILED | BusinessException |
| API 限流 | 429 TOO_MANY_REQUESTS | SystemException |
| 数据库连接失败 | 500 INTERNAL_SERVER_ERROR | SystemException |
| 文件 IO 错误 | 500 INTERNAL_SERVER_ERROR | SystemException |
| 第三方服务调用失败 | 502 BAD_GATEWAY | SystemException |
| 服务正在维护 | 503 SERVICE_UNAVAILABLE | SystemException |
| 上游服务超时 | 504 GATEWAY_TIMEOUT | SystemException |

### 3. 异常类选择指南

| 场景 | 使用异常类 | 说明 |
|------|-----------|------|
| 业务逻辑验证失败 | BusinessException | 如余额不足、库存不足、重复提交等 |
| 资源状态冲突 | BusinessException | 如邮箱已注册、订单已支付等 |
| 权限验证失败 | BusinessException | 如无权访问、未登录等 |
| 参数验证失败 | BusinessException | 如参数格式错误、必填项缺失等 |
| 数据库操作失败 | SystemException | 如连接失败、SQL 执行错误等 |
| 文件操作失败 | SystemException | 如文件不存在、读写失败等 |
| 网络通信失败 | SystemException | 如 RPC 调用失败、HTTP 请求超时等 |
| 配置错误 | SystemException | 如配置项缺失、格式错误等 |
| 通用系统错误 | SystemException | 如内存不足、线程池满等 |

### 4. 状态码使用注意事项

1. **语义准确性**：选择与操作语义最匹配的状态码
2. **一致性**：整个项目保持状态码使用的一致性
3. **客户端友好**：提供清晰的错误消息，帮助客户端理解问题
4. **文档化**：在 API 文档中明确说明可能返回的状态码
5. **优先使用枚举**：使用 `HttpStatusCode` 枚举而非硬编码状态码数值
6. **合理区分异常类型**：业务错误使用 `BusinessException`，系统错误使用 `SystemException`
7. **保留异常链**：捕获异常时保留原始异常（cause），便于排查问题

## 扩展建议

如果项目需要支持更多的 HTTP 状态码，可以按照以下格式添加：

```java
@Schema(description = "描述")
NEW_STATUS(代码, "Reason Phrase", "用户友好提示", "详细描述"),
```

## 参考资料

- [RFC 9110 - HTTP Semantics](https://www.rfc-editor.org/rfc/rfc9110.html)
- [MDN HTTP Status Codes](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status)
- [RESTful API 设计最佳实践](https://restfulapi.net/http-status-codes/)

